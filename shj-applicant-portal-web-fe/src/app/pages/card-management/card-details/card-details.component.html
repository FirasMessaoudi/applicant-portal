<nav aria-label="breadcrumb" class="pt-2">
  <ol class="breadcrumb bg-white mb-0 px-0 d-none d-md-flex">
    <li class="breadcrumb-item active" aria-current="page "></li>
  </ol>
</nav>
<div *ngIf="loading" class="preloader">
  <div></div>
  <div></div>
  <div></div>
</div>
<div *ngIf="!loading" class="content__wrapper">
  <div class="title__Page">
    <h3 class="sectionTitle">
      {{ "card-management.my_profile" | translate }}
      <!-- {{'card-management.card_details' | translate }} -->
    </h3>
    <a class="btn  btn-dcc-primary px-4" [routerLink]="['/cards/hajj-card/1']">
      <span>{{ "card-management.view_my_card" | translate }} </span>
      <svg-icon styleClass="ml-3 mb-0 h5" icon="id-card-light"></svg-icon>
    </a>
  </div>

  <div class="row cardBox">
    <div class="col-12 col-md-4 order-md-1 order-1 order-md-0">
      <div class="col-form-label text-center text-md-left">
        <span *ngIf="applicant?.fullNameAr as value; else elseBlock">{{value}}</span>
      </div>
      <div class="form-control-plaintext text-center text-md-left">
        <span *ngIf="applicant?.fullNameEn as value; else elseBlock">{{value}}</span>
      </div>
    </div>

    <div class="col-12 col-md-2 order-2 order-md-1">
      <div class="col-form-label text-center text-md-left">
        {{ "card-management.applicant_id" | translate }}
      </div>
      <div class="form-control-plaintext text-center text-md-left">
        <span class="mr-3" *ngIf="applicant?.uin as value; else elseBlock">{{value}}</span>
        <span class="status_wraper">
          <span class="status done mr-1"></span>
          <span>{{'card-management.status_active' | translate}}</span>
        </span>
      </div>
    </div>

    <div class="col-12 col-md-2 order-2 order-md-1">
      <div class="col-form-label text-center text-md-left">
        {{ "card-management.card_number" | translate }}
      </div>
      <div *ngIf="applicant?.cardReferenceNumber as value; else elseBlock" class="form-control-plaintext text-center text-md-left">
        <span class="mr-3">{{value}}</span>
        <span class="status_wraper">
          <span class="status {{buildStatusClass(applicant?.cardStatusCode)}} mr-1"></span>
          <span>{{applicant?.cardStatusCode ? getCardStatus(applicant?.cardStatusCode) : '---'}}</span>
        </span>
      </div>
    </div>

    <div class="col-12 col-md-4 order-0 order-md-3 d-flex justify-content-center maskAv">
            <span class="avatar">
        <img
          [src]="
            applicant?.photo
              ? 'data:image/jpeg;base64,' +
                applicant?.photo
              : url
          "
        />
      </span>
    </div>
  </div>
  <!--Responsive view -->
  <div class="container nav d-block d-md-none mt-4">
    <header class="nav-header">
      <nav class="middle scroll">
                <span (click)="activeId = i + 1" [ngClass]="{ active: activeId == i + 1 }"
                      *ngFor="let title of tabsHeader; let i = index" class="item">
          {{ title | translate }}
        </span>
      </nav>
    </header>
  </div>

  <ul ngbNav #nav="ngbNav" class="nav-tabs" [(activeId)]="activeId">
    <li [ngbNavItem]="1">
      <a class="d-none d-md-block" ngbNavLink>{{
        "card-management.main_details" | translate
        }}</a>
      <ng-template ngbNavContent>
        <section>
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3">
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.applicant_original_name" | translate
                }}</label>

              <span class="form-control-plaintext"
                    *ngIf="applicant?.fullNameOrigin  as value; else elseBlock">{{value}}</span>

            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "general.date_of_birth" | translate
                }}</label>
              <span class="form-control-plaintext">{{
                applicant?.dateOfBirthGregorian
                  | gregorianDateFormat
                }}
                <span
                  *ngIf="applicant?.dateOfBirthGregorian"
                >-</span
                >
                {{
                applicant?.dateOfBirthHijri
                  | hijriDateFormat
                }}
              </span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.ritual_type" | translate
                }}</label>
              <span class="form-control-plaintext">{{
                applicant?.ritualTypeCode
                  ? lookupService().localizedLabel(
                    ritualTypes,
                    applicant?.ritualTypeCode
                  )
                  : '---'
                }}</span>
            </div>

            <div class="form-group col" [ngSwitch]="applicant?.gender?.toUpperCase()">
              <label class="col-form-label">{{
                "general.gender" | translate
                }}</label>
              <span class="form-control-plaintext" *ngSwitchCase="'F'">{{
                "user-management.female" | translate
                }}</span>
              <span class="form-control-plaintext" *ngSwitchCase="'M'">{{
                "user-management.male" | translate
                }}</span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.nationality" | translate
                }}</label>
              <span class="form-control-plaintext">{{
                applicant?.nationalityCode
                  ? lookupService().localizedLabel(
                    countries,
                    applicant?.nationalityCode?.toUpperCase()
                  )
                  : '---'
                }}</span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.passport_number" | translate
                }}</label>

              <span class="form-control-plaintext"
                    *ngIf="applicant?.passportNumber as value; else elseBlock">{{value}}</span>

            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.marital_status" | translate
                }}</label>
              <br>
              <span class="form-control-plaintext" *ngIf="applicant?.maritalStatusCode as value; else elseBlock">
                {{lookupService().localizedLabel(
                maritalStatuses,
                value.toUpperCase()
              )}}</span>


            </div>
            <div *ngIf="applicant?.idNumberOriginal" class="form-group col">
              <label class="col-form-label">{{
                "card-management.applicant_original_id" | translate
                }}</label>
              <span class="form-control-plaintext"
                    *ngIf="applicant?.idNumberOriginal as value; else elseBlock">{{value}}</span>

            </div>
            <div *ngIf="applicant?.idNumber" class="form-group col">
              <label class="col-form-label">{{'general.nin_or_iqama' | translate}}</label>
              <span class="form-control-plaintext" *ngIf="applicant?.idNumber as value; else elseBlock">{{value}}</span>

            </div>

            <div class="form-group col">
              <label class="col-form-label">{{'card-management.applicant_languages' | translate}}</label>
              <span class="form-control-plaintext">
                  <span *ngFor="let lang of applicant?.contacts[0]?.languageList.split(','); let lastItem = last;">
                    {{languageNativeName[lang.trim().toUpperCase()]}}<span *ngIf="!lastItem">-</span></span>
                  </span>
              <span *ngIf="applicant?.contacts?.length == 0" class="col-form-label">---</span>
            </div>
          </div>
        </section>
        <hr class="my-4 w-100"/>
        <section>
                    <span class="form-control-plaintext">{{
                      "card-management.applicant_original_address" | translate
                      }}</span>
          <div class="text-center" *ngIf="!applicant?.contacts[0]">
            <svg-icon styleClass="display-1 text-dcc-light" icon="empty-set"></svg-icon>
            <p class="text-light-gray mb-3">{{ "general.no-data-found" | translate }}</p>
          </div>
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3" *ngIf="applicant?.contacts[0]">
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.country" | translate
                }}</label>

              <br>
              <span class="form-control-plaintext"
                    *ngIf="applicant?.contacts[0]?.countryCode  as value; else elseBlock">{{lookupService().localizedLabel(
                countries,
                value.toUpperCase()
              )}}</span>

            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.city" | translate
                }}</label>
              <br>
              <span class="form-control-plaintext"
                    *ngIf="applicant?.contacts[0]?.cityName as value; else elseBlock">{{value}}</span>

            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.district" | translate
                }}</label>
              <br>
              <span class="form-control-plaintext"
                    *ngIf="applicant?.contacts[0]?.districtName as value; else elseBlock">{{value}}</span>

            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.street" | translate
                }}</label>
              <br>
              <span class="form-control-plaintext"
                    *ngIf="applicant?.contacts[0]?.streetName as value; else elseBlock">{{value}}</span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.building_number" | translate
                }}</label>
              <br>

              <span class="form-control-plaintext"
                    *ngIf="applicant?.contacts[0]?.buildingNumber">{{applicant?.contacts[0]?.buildingNumber}}</span>
              <span class="col-form-label" *ngIf="!applicant?.contacts[0]?.buildingNumber">---</span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.postal_code" | translate
                }}</label>
              <br>
              <span class="form-control-plaintext"
                    *ngIf="applicant?.contacts[0]?.postalCode  as value; else elseBlock">{{value}}</span>

            </div>
          </div>
        </section>
        <hr class="my-4 w-100"/>
        <section>
                    <span class="form-control-plaintext">{{
                      "card-management.applicant_relatives" | translate
                      }}</span>
          <div class="text-center" *ngIf="!(applicant?.relatives?.length > 0)">
            <svg-icon styleClass="display-1 text-dcc-light" icon="empty-set"></svg-icon>
            <p class="text-light-gray mb-3">{{ "general.no-data-found" | translate }}</p>
          </div>
          <div class="table-responsive my-4" *ngIf="applicant?.relatives?.length > 0">
            <table class="table table-striped table-hover">
              <thead>
              <tr>
                <th scope="col">
                  {{ "card-management.applicant_name" | translate }}
                </th>
                <th scope="col">
                  {{ "card-management.applicant_id" | translate }}
                </th>
                <th scope="col">
                  {{ "card-management.applicant_relative_type" | translate }}
                </th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="
                    let relative of applicant?.relatives
                  ">
                <td class="ltr">
                  {{ relative.relativeApplicant?.fullNameAr }} {{ relative.relativeApplicant?.fullNameEn }}
                </td>
                <td class="ltr">
                  {{ relative.relativeApplicant?.digitalIds[0]?.uin }}
                </td>
                <td class="ltr">
                  {{ relative.relationshipCode ? lookupService().localizedLabel(relativeRelationships, relative.relationshipCode) : "" }}
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </section>
      </ng-template>
    </li>
    <li [ngbNavItem]="2" (click)="loadUserPackageDetails()">
      <a ngbNavLink>{{'card-management.package_details' | translate}}</a>
      <ng-template ngbNavContent>
        <app-hamlah-details
          [applicantPackage]="applicantPackage"
          [housingCategories]="housingCategories"
          [housingSites]="housingSites"
          [housingTypes]="housingTypes"
          [packageTypes]="packageTypes"
          [currentLanguage]="currentLanguage"
          [transportationTypes]="transportationTypes"
        ></app-hamlah-details>
      </ng-template>
    </li>

    <li [ngbNavItem]="3" (click)="loadHealthDetails()">
      <a class="d-none d-md-block" ngbNavLink>{{
        "card-management.health_details" | translate
        }}</a>
      <ng-template ngbNavContent>
        <section>
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3">
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.blood_type" | translate
                }}</label>
              <span class="form-control-plaintext">{{
                healthDetails?.bloodType
                }}</span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.special_needs_assistance_needed" | translate
                }}</label>
              <span class="form-control-plaintext" *ngIf="
                  healthDetails?.specialNeeds
                    ?.length > 0
                ">{{ "general.label_yes" | translate }}</span
              >
              <span
                class="form-control-plaintext"
                *ngIf="
                  healthDetails?.specialNeeds
                    ?.length === 0
                "
              >{{ "general.label_no" | translate }}</span
              >
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.have_chronic_diseases" | translate
                }}</label>
              <span
                class="form-control-plaintext"
                *ngIf="
                  healthDetails?.diseases
                    ?.length > 0
                "
              >{{ "general.label_yes" | translate }}</span
              >
              <span
                class="form-control-plaintext"
                *ngIf="
                  healthDetails?.diseases
                    ?.length === 0
                "
              >{{ "general.label_no" | translate }}</span
              >
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.vaccinated" | translate
                }}</label>
              <span
                class="form-control-plaintext"
                *ngIf="
                  healthDetails?.immunizations
                    ?.length > 0
                "
              >{{ "general.label_yes" | translate }}</span
              >
              <span
                class="form-control-plaintext"
                *ngIf="
                  healthDetails?.immunizations
                    ?.length === 0
                "
              >{{ "general.label_no" | translate }}</span
              >
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.special_needs" | translate
                }}</label>
              <span class="form-control-plaintext">
                <span
                  *ngFor="
                    let need of healthDetails?.specialNeeds;
                    let lastItem = last
                  "
                >
                  {{
                  need.specialNeedTypeCode
                    ? lookupService().localizedLabel(
                      healthSpecialNeeds,
                      need.specialNeedTypeCode
                    )
                    : ""
                  }}<span *ngIf="!lastItem">-</span></span>
                            </span>
            </div>
            <div class="form-group col">
              <label class="col-form-label">{{
                "card-management.chronic_diseases" | translate
                }}</label>
              <span class="form-control-plaintext">
                <span
                  *ngFor="
                    let disease of healthDetails?.diseases;
                    let lastItem = last
                  "
                >
                  {{
                  currentLanguage.startsWith("en")
                    ? disease.labelEn
                    : disease.labelAr
                  }}<span *ngIf="!lastItem">-</span></span>
                            </span>
            </div>
          </div>
        </section>
        <hr class="my-4 w-100"/>
        <section>
          <span class="form-control-plaintext">{{"card-management.vaccinations" | translate}}</span>
          <div class="text-center" *ngIf="!healthDetails?.immunizations">
            <svg-icon styleClass="display-1 text-dcc-light" icon="empty-set"></svg-icon>
            <p class="text-light-gray mb-3">{{ "general.no-data-found" | translate }}</p>
          </div>
          <div class="table-responsive my-4" *ngIf="healthDetails?.immunizations">
            <table class="table table-striped table-hover">
              <thead>
              <tr>
                <th scope="col">
                  {{ "card-management.vaccination_name" | translate }}
                </th>
                <th scope="col">
                  {{ "card-management.vaccination_date" | translate }}
                </th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="
                    let immunization of healthDetails?.immunizations
                  ">
                <td class="ltr">{{ immunization.immunizationCode }}</td>
                <td class="ltr">
                  {{ immunization.immunizationDate | gregorianDateFormat }}
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </section>
      </ng-template>
    </li>
    <li [ngbNavItem]="4">
      <a class="d-none d-md-block" ngbNavLink>{{
        "card-management.tafweej_details" | translate
        }}</a>
      <ng-template ngbNavContent>
        <app-tafweej-details [companyRitualSteps]="tafweejDetails"
                             [ritualStepsLabels]="ritualStepsLabels"></app-tafweej-details>
      </ng-template>
    </li>
    <li [ngbNavItem]="5">
      <a class="d-none d-md-block" ngbNavLink>{{
        "card-management.motawef_details" | translate
        }}</a>
      <ng-template ngbNavContent>
        <app-group-leaders [applicantGroupLeaders]="groupLeaders"
                           [groupLeadersTitle]="groupLeaderTitle"></app-group-leaders>
      </ng-template>
    </li>
  </ul>

  <div [ngbNavOutlet]="nav" class="mt-2"></div>
  <ng-template #elseBlock><span class="col-form-label">---</span></ng-template>

</div>
