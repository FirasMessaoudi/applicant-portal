<div *ngIf="showAlert" class="alert reset-ritual mb-0" role="alert">
  <div class="d-flex justify-content-between align-items-center w-100 h-100"
       [ngClass]="{ container: showNavbar, 'px-md-0': showNavbar }">
    <div>
      <svg-icon class="mr-3" styleClass="fa" icon="lightbulb-exclamation"></svg-icon>
      <span>{{'header.alert_text' | translate}}</span>
      {{selectedRitualSeason?.ritualSeason?.seasonYear}}
    </div>
    <a class="reset-btn noArrow py-1 px-3" (click)="backToLatestRitualSeason()">
      <span>{{'header.alert_button_text' | translate}}</span>
      <svg-icon styleClass="fa ml-2" icon="redo"></svg-icon>
    </a>
  </div>
</div>
<header class="header-wrapper" [ngClass]="{ light_navbar: showNavbar }">
  <div class="d-flex justify-content-between align-items-center w-100"
       [ngClass]="{ container: showNavbar, 'px-md-0': showNavbar }">
    <div class="left-header d-flex">
      <!--BACK BUTTON-->
      <a *ngIf="!showNavbar" class="d-block" (click)="goBack()" href="javascript:void(0);">
        <svg-icon styleClass="ml-4 mr-2 flip" icon="arrow-right"></svg-icon>
        <span class="mx-2 px-1">{{ "general.btn_back" | translate }}</span>
      </a>

      <!-- LOGO -->
      <div *ngIf="showNavbar" class="logo flex-center py-3" [ngClass]="{ 'px-md-2': showNavbar }">
        <a href="javascript:void(0)" [routerLink]="['/']">
          <img src="assets/images/logo.png" alt="logo"/>
        </a>
      </div>

      <!-- NAVIGATION  -->
      <div *ngIf="showNavbar" class="d-flex">
        <nav class="navbar p-0 d-none d-md-flex mx-5">
          <div class="main-nav">
            <ul class="nav d-flex">
              <li routerLinkActive="active">
                <a (click)="isActive = false" class="py-2 d-block h6"
                   [routerLink]="['/cards/details/1']">{{ 'header.my_dashboard' | translate }}</a>
              </li>
              <li routerLinkActive="disable">
                <a (click)="isActive = false" class="py-2 d-block h6 "
                   [routerLink]="['/hajj-rituals']">{{ 'header.my_program' | translate }}</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>

    </div>

    <!--- PROFILE & SETTING-->
    <div class="nav-right">
      <ul class="nav-menus" [ngClass]="{ 'mx-0': showNavbar }">
        <li class="flex-center">
          <a class="nav-link d-flex align-items-top noArrow">
            <svg-icon styleClass="h1 text-gray-300" icon="user-circle"></svg-icon>
            <div class="mx-3">
              <h6 class="text-dcc-primary m-0">
                {{ currentUser?.firstName }} {{ currentUser?.lastName }}
              </h6>
              <small class="mb-2">
                <a class="text-black-50" (click)="open(showEditRitual)" href="javascript:void(0)">
                  {{selectedRitualSeason?.ritualSeason?.ritualTypeCode ? lookupService().localizedLabel(ritualTypes, selectedRitualSeason?.ritualSeason?.ritualTypeCode) : ""}}
                  <span *ngIf="currentLanguage.startsWith('ar')">عام</span>
                  {{selectedRitualSeason?.ritualSeason?.seasonYear}}
                </a>
              </small>
            </div>
          </a>
        </li>
        <li class="position-relative">

          <a class="nav-link d-flex align-items-center dropdown-toggle noArrow"
             [autoClose]="'outside'"
             [ngbPopover]="popContent"
             placement="bottom"

             href="javascript:void(0)"
             ngbTooltip="{{'header.notifications' | translate}}"
             title="notifications"
             id="notificationsLink"
          >
            <svg-icon styleClass="fa-w-16 h4" icon="bell"></svg-icon>
            <span class="notif bg-red" *ngIf="allNotifications?.length > 0">{{allNotifications?.length}}</span>
          </a>

          <ng-template #popContent>
            <ul ngbNav #nav="ngbNav" class="nav-tabs" [(activeId)]="activeId">
              <li [ngbNavItem]="1">
                <a class="p-3" ngbNavLink><b>{{"notification-management.private_notifications" | translate}}
                  ({{privateNotifications?.length}})</b></a>
                <ng-template ngbNavContent>

                  <div class="d-flex border-bottom p-3 state-success" *ngFor="let notification of privateNotifications">
                    <div class="nIcon mr-3">
                      <svg-icon styleClass="fa-w-18" icon="state-success"></svg-icon>
                    </div>
                    <div class="w-100">
                      <div>
                        <div class="flex-center-between align-items-start">
                          <b class="text-dark">{{notification?.title}}</b>
                          <div class="d-flex">
                            <small
                              class="mr-1 text-muted text-nowrap">{{getRelativeTime(notification?.creationDate)}}</small>
                            <svg-icon styleClass="text-light-gray" icon="read"></svg-icon>
                          </div>
                        </div>
                        <p class="mt-2 mb-3">{{notification?.resolvedBody}}</p>
                      </div>
                      <div class="Nbtn" *ngIf="notification?.actionRequired">
                        <button
                          class="btn btn-sm btn-outline-dcc-dark-primary pt-1">{{notification?.actionLabel}}</button>
                      </div>
                    </div>
                  </div>

                  <!--                  <div class="d-flex border-bottom p-3 state-info">
                                      <div class="nIcon mr-3">
                                        <svg-icon styleClass="fa-w-18" icon="state-info"></svg-icon>
                                      </div>
                                      <div class="w-100">
                                        <div>
                                          <div class="flex-center-between align-items-start">
                                            <b class="text-dark">تم إصدار البطاقة الذكية</b>
                                            <div class="d-flex">
                                              <small class="mr-1 text-muted text-nowrap">منذ 5 ساعات</small>
                                              <svg-icon styleClass="text-light-gray" icon="unread"></svg-icon>
                                            </div>
                                          </div>
                                          <p class="mt-2 mb-3">تم إصدار البطاقة الذكية الخاصة بك. الرجاء التواصل مع قائد الحملة لاستلامها</p>
                                        </div>
                                      </div>
                                    </div>

                                    <div class="d-flex border-bottom p-3 state-general">
                                      <div class="nIcon mr-3">
                                        <svg-icon styleClass="fa-w-18" icon="state-general"></svg-icon>
                                      </div>
                                      <div class="w-100">
                                        <div>
                                          <div class="flex-center-between align-items-start">
                                            <b class="text-dark">تقييم الخدمات اليومي</b>
                                            <div class="d-flex">
                                              <small class="mr-1 text-muted text-nowrap">أمس</small>
                                              <svg-icon styleClass="text-light-gray" icon="read"></svg-icon>
                                            </div>
                                          </div>
                                          <p class="mt-2 mb-3">تقييم الخدمات يساعد على الرقي بالخدمات المقدمة نأمل منكم تقييم خدمات اليوم</p>
                                        </div>
                                        <div class="Nbtn">
                                          <button class="btn btn-sm btn-outline-dcc-dark-primary pt-1">تقييم الخدمات</button>
                                        </div>
                                      </div>
                                    </div>-->

                </ng-template>
              </li>
              <li [ngbNavItem]="2">
                <a class="p-3" ngbNavLink><b>{{"notification-management.public_notifications" | translate}}
                  ({{publicNotifications?.length}})</b></a>
                <ng-template ngbNavContent>
                  <div class="d-flex border-bottom p-3 state-success" *ngFor="let notification of publicNotifications">
                    <div class="nIcon mr-3">
                      <svg-icon styleClass="fa-w-18" icon="state-success"></svg-icon>
                    </div>
                    <div class="w-100">
                      <div>
                        <div class="flex-center-between align-items-start">
                          <b class="text-dark">{{notification?.title}}</b>
                          <div class="d-flex">
                            <small
                              class="mr-1 text-muted text-nowrap">{{getRelativeTime(notification?.creationDate)}}</small>
                            <svg-icon styleClass="text-light-gray" icon="read"></svg-icon>
                          </div>
                        </div>
                        <p class="mt-2 mb-3">{{notification?.resolvedBody}}</p>
                      </div>
                      <div class="Nbtn" *ngIf="notification?.actionRequired">
                        <button
                          class="btn btn-sm btn-outline-dcc-dark-primary pt-1">{{notification?.actionLabel}}</button>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </li>
            </ul>
            <div [ngbNavOutlet]="nav" class="mt-2"></div>

            <div class="flex-center py-3">
              <a class="text-body"
                 [routerLink]="['/notifications']"><b>{{"notification-management.view_all_notifications" | translate}}</b></a>
              <svg-icon styleClass="text-black-50 mx-2" icon="chevron-double-left"></svg-icon>
            </div>

          </ng-template>

        </li>
        <li class="position-relative">
          <a class="nav-link" [routerLink]="['/settings']" ngbTooltip="{{ 'header.settings' | translate }}">
            <svg-icon styleClass="fa-w-16 h4" icon="cog"></svg-icon>
          </a>
        </li>
        <li class="position-relative">
          <a class="nav-link" href="javascript:void(0)" (click)="logout()"
             ngbTooltip="{{ 'header.logout' | translate }}">
            <svg-icon styleClass="fa-w-16 h4 flip" icon="logout"></svg-icon>
          </a>
        </li>
      </ul>
    </div>
  </div>
</header>

<ng-template class="edit-ritual-modal" #showEditRitual let-modal>
  <div class="modal-header">
    <h4 class="sectionTitle">{{'header.change_ritual_modal_title' | translate}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true" class="h2">&times;</span>
    </button>
  </div>
  <div class="modal-body px-0">
    <table class="w-100">
      <tr class="table-row" *ngFor="let index = index; let s of seasons">
        <td class="ritual-season p-lg-3" (click)="selectSeason(s.id)">
          <div class="d-flex justify-content-between align-items-center">
            <div class="ml-3 ritual-item">
              {{s.ritualSeason?.ritualTypeCode ? lookupService().localizedLabel(ritualTypes, s.ritualSeason?.ritualTypeCode) : ""}}
              <span *ngIf="currentLanguage.startsWith('ar')">عام</span>
              {{s.ritualSeason?.seasonYear}}
            </div>
            <div>
              <svg-icon *ngIf="s.selected" class="check-circle" styleClass="fa2x mr-2" icon="check-circle"></svg-icon>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
  <div class="modal-footer">
    <div>
      <svg-icon styleClass="fa mr-2" icon="lightbulb-exclamation"></svg-icon>
      <span>{{'header.change_ritual_modal_caution' | translate}}</span>
    </div>
    <button type="button" class="btn btn-dcc-primary px-4 ml-3"
            (click)="confirm()">{{'general.btn_confirm' | translate}}</button>
  </div>
</ng-template>
